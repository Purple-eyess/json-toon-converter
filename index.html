<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JSON to TOON Converter</title>
    
    <!-- 1. Cargar Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 2. Cargar React y ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- 3. Cargar Babel para traducir JSX en el navegador -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Estilos base para scrollbars y selección -->
    <style>
        body { background-color: #020617; color: #e2e8f0; }
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #0f172a; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #475569; }
        ::selection { background-color: rgba(99, 102, 241, 0.3); color: white; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- ICONOS SVG ---
        const Icons = {
            Zap: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>,
            Cpu: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><rect x="4" y="4" width="16" height="16" rx="2" ry="2"/><rect x="9" y="9" width="6" height="6"/><line x1="9" y1="1" x2="9" y2="4"/><line x1="15" y1="1" x2="15" y2="4"/><line x1="9" y1="20" x2="9" y2="23"/><line x1="15" y1="20" x2="15" y2="23"/><line x1="20" y1="9" x2="23" y2="9"/><line x1="20" y1="14" x2="23" y2="14"/><line x1="1" y1="9" x2="4" y2="9"/><line x1="1" y1="14" x2="4" y2="14"/></svg>,
            ArrowRight: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M5 12h14"/><path d="m12 5 7 7-7 7"/></svg>,
            FileJson: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"/><path d="M14 2v4a2 2 0 0 0 2 2h4"/><path d="M10 12a1 1 0 0 0-1 1v1a1 1 0 0 1-1 1 1 1 0 0 1 1 1v1a1 1 0 0 0 1 1"/></svg>,
            Upload: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>,
            Trash2: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" y1="11" x2="10" y2="17"/><line x1="14" y1="11" x2="14" y2="17"/></svg>,
            Sparkles: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/><path d="M5 3v4"/><path d="M9 3v4"/><path d="M3 7h4"/><path d="M3 5h4"/></svg>,
            Copy: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><rect width="14" height="14" x="8" y="8" rx="2" ry="2"/><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/></svg>,
            Check: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><polyline points="20 6 9 17 4 12"/></svg>,
            TrendingUp: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><polyline points="22 7 13.5 15.5 8.5 10.5 2 17"/><polyline points="16 7 22 7 22 13"/></svg>,
            Activity: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></svg>,
            Server: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><rect width="20" height="8" x="2" y="2" rx="2" ry="2"/><rect width="20" height="8" x="2" y="14" rx="2" ry="2"/><line x1="6" y1="6" x2="6.01" y2="6"/><line x1="6" y1="18" x2="6.01" y2="18"/></svg>
        };

        const App = () => {
            const [jsonInput, setJsonInput] = useState(`{
  "users": [
    {"id": 1, "name": "Alice", "role": "admin"},
    {"id": 2, "name": "Bob", "role": "user"},
    {"id": 3, "name": "Charlie", "role": "editor"}
  ],
  "settings": {
    "theme": "darko",
    "notifications": true,
    "retries": 3
  },
  "metadata": {
    "version": "latest",
    "active": true
  }
}`);
            const [toonOutput, setToonOutput] = useState('');
            const [error, setError] = useState(null);
            const [stats, setStats] = useState({ jsonLen: 0, toonLen: 0, saved: 0 });
            const [copied, setCopied] = useState(false);
            const fileInputRef = useRef(null);

            // Modelos 
            const models = [
                { 
                    id: 'claude-4-5', 
                    name: 'Claude 4.5 Sonnet', 
                    provider: 'Anthropic', 
                    score: 99, 
                    color: 'bg-orange-600',
                    desc: 'Comprensión contextual perfecta. El mejor para recomponer TOON complejo.'
                },
                { 
                    id: 'gemini-3-pro', 
                    name: 'Gemini 3 Pro', 
                    provider: 'Google', 
                    score: 98, 
                    color: 'bg-blue-600',
                    desc: 'Ventana de contexto infinita nativa. Ideal para datasets masivos en n8n.'
                },
                { 
                    id: 'grok-4-1', 
                    name: 'Grok 4.1', 
                    provider: 'xAI', 
                    score: 96, 
                    color: 'bg-slate-100',
                    desc: 'Razonamiento lógico puro y velocidad bruta. Muy eficiente.'
                },
                { 
                    id: 'gpt-5-turbo', 
                    name: 'GPT-5 Turbo', 
                    provider: 'OpenAI', 
                    score: 95, 
                    color: 'bg-emerald-600',
                    desc: 'El estándar industrial actualizado. Fiable para el Workflow Builder.'
                },
                { 
                    id: 'llama-4-405b', 
                    name: 'Llama 4 405B', 
                    provider: 'Meta (Open Source)', 
                    score: 92, 
                    color: 'bg-indigo-600',
                    desc: 'Soberanía de datos. Ejecución local de alta fidelidad.'
                }
            ];

            const convertToToon = (jsonStr) => {
                try {
                    if (!jsonStr.trim()) return '';
                    const data = JSON.parse(jsonStr);
                    setError(null);
                    
                    const lines = [];

                    const processNode = (key, value, level = 0) => {
                        const indent = '  '.repeat(level);
                        
                        // Caso 1: Array de Objetos
                        if (Array.isArray(value) && value.length > 0 && typeof value[0] === 'object' && value[0] !== null) {
                            const keys = Object.keys(value[0]);
                            const headers = keys.join(',');
                            
                            lines.push(`${indent}${key}[${value.length}]{${headers}}:`);
                            
                            value.forEach(item => {
                                const row = keys.map(k => {
                                    const val = item[k];
                                    return val === undefined ? '' : val;
                                }).join(',');
                                lines.push(`${indent}  ${row}`);
                            });
                            return;
                        }

                        // Caso 2: Objeto estándar
                        if (typeof value === 'object' && value !== null && !Array.isArray(value)) {
                            if (key) lines.push(`${indent}${key}:`);
                            Object.entries(value).forEach(([subKey, subVal]) => {
                                processNode(subKey, subVal, key ? level + 1 : level);
                            });
                            return;
                        }

                        // Caso 3: Array simple
                        if (Array.isArray(value)) {
                            lines.push(`${indent}${key}: [${value.join(', ')}]`);
                            return;
                        }

                        // Caso 4: Primitivos
                        lines.push(`${indent}${key}: ${value}`);
                    };

                    if (typeof data === 'object' && !Array.isArray(data)) {
                        Object.entries(data).forEach(([key, value]) => processNode(key, value, 0));
                    } else if (Array.isArray(data)) {
                        processNode('root', data, 0);
                    }

                    return lines.join('\n');

                } catch (err) {
                    setError(err.message);
                    return '';
                }
            };

            useEffect(() => {
                const converted = convertToToon(jsonInput);
                setToonOutput(converted);

                const jLen = jsonInput.length;
                const tLen = converted.length;
                const savedPct = jLen > 0 ? ((jLen - tLen) / jLen) * 100 : 0;
                
                setStats({
                    jsonLen: jLen,
                    toonLen: tLen,
                    saved: Math.max(0, savedPct.toFixed(1))
                });

            }, [jsonInput]);

            const handleCopy = () => {
                const textArea = document.createElement("textarea");
                textArea.value = toonOutput;
                document.body.appendChild(textArea);
                textArea.select();
                try {
                    document.execCommand('copy');
                    setCopied(true);
                    setTimeout(() => setCopied(false), 2000);
                } catch (err) {
                    console.error('Error al copiar', err);
                }
                document.body.removeChild(textArea);
            };

            const handleFileUpload = (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (e) => setJsonInput(e.target.result);
                    reader.readAsText(file);
                }
            };

            const loadSample = () => {
                const sample = {
                    "agents": [
                        {"id": "a1", "model": "gpt-5-turbo", "temp": 0.7, "status": "active"},
                        {"id": "a2", "model": "claude-4.5-sonnet", "temp": 0.5, "status": "reasoning"},
                        {"id": "a3", "model": "gemini-3-pro", "temp": 0.9, "status": "idle"}
                    ],
                    "workflow": {
                        "engine": "n8n-enterprise",
                        "version": "latest",
                        "features": ["ai-builder", "gpu-acceleration"]
                    }
                };
                setJsonInput(JSON.stringify(sample, null, 2));
            };

            return (
                <div className="min-h-screen bg-slate-950 text-slate-200 p-4 md:p-8 font-sans selection:bg-indigo-500/30">
                    
                    <header className="max-w-7xl mx-auto mb-8 flex flex-col md:flex-row items-center justify-between gap-4">
                        <div className="flex items-center gap-3">
                            <div className="bg-gradient-to-br from-indigo-500 to-purple-600 p-2.5 rounded-xl shadow-lg shadow-indigo-500/20">
                                <Icons.Zap className="w-6 h-6 text-white" />
                            </div>
                            <div>
                                <h1 className="text-2xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-indigo-400 to-purple-400">
                                    JSON a TOON
                                </h1>
                                <p className="text-slate-500 text-sm">Optimiza prompts para n8n AI Agents</p>
                            </div>
                        </div>

                        <div className="flex items-center gap-4 bg-slate-900/50 p-2 rounded-lg border border-slate-800 backdrop-blur-sm">
                            <div className="flex items-center gap-2 px-3">
                                <Icons.Cpu className="w-4 h-4 text-emerald-400" />
                                <span className="text-sm font-medium text-slate-400">Reducción:</span>
                                <span className="text-emerald-400 font-bold">{stats.saved}%</span>
                            </div>
                            <div className="h-4 w-px bg-slate-700"></div>
                            <div className="px-3 text-xs text-slate-500 flex items-center">
                                {stats.jsonLen} <Icons.ArrowRight className="inline w-3 h-3 mx-1"/> {stats.toonLen}
                            </div>
                        </div>
                    </header>

                    <main className="max-w-7xl mx-auto space-y-8">
                        <div className="grid grid-cols-1 lg:grid-cols-2 gap-6 h-auto min-h-[600px]">
                            {/* Input */}
                            <div className="flex flex-col gap-3 group h-full">
                                <div className="flex justify-between items-center px-1">
                                    <label className="text-sm font-semibold text-slate-400 flex items-center gap-2">
                                        <Icons.FileJson className="w-4 h-4" /> JSON Entrada
                                    </label>
                                    <div className="flex gap-2">
                                        <button onClick={loadSample} className="text-xs px-3 py-1.5 rounded-md bg-slate-800 hover:bg-slate-700 text-slate-300 border border-slate-700">Ejemplo</button>
                                        <button onClick={() => fileInputRef.current.click()} className="text-xs px-3 py-1.5 rounded-md bg-indigo-600/10 hover:bg-indigo-600/20 text-indigo-400 border border-indigo-500/30 flex items-center gap-1">
                                            <Icons.Upload className="w-3 h-3" /> Subir
                                        </button>
                                        <input type="file" ref={fileInputRef} className="hidden" accept=".json" onChange={handleFileUpload} />
                                        <button onClick={() => setJsonInput('')} className="text-xs px-2 py-1.5 rounded-md hover:bg-red-500/10 text-slate-500 hover:text-red-400"><Icons.Trash2 className="w-4 h-4" /></button>
                                    </div>
                                </div>
                                <div className={`flex-1 relative rounded-xl border transition-all duration-300 min-h-[300px] ${error ? 'border-red-500/50 bg-red-950/5' : 'border-slate-800 bg-slate-900/50 hover:border-slate-700 focus-within:border-indigo-500/50'}`}>
                                    <textarea value={jsonInput} onChange={(e) => setJsonInput(e.target.value)} className="w-full h-full bg-transparent p-5 font-mono text-sm resize-none focus:outline-none text-slate-300 placeholder:text-slate-600" spellCheck="false" placeholder='Pega tu JSON aquí...'></textarea>
                                    {error && <div className="absolute bottom-4 left-4 right-4 bg-red-900/90 text-red-100 text-xs p-3 rounded-lg border border-red-700/50"><strong>Error:</strong> {error}</div>}
                                </div>
                            </div>

                            {/* Mobile Arrow */}
                            <div className="lg:hidden flex justify-center py-2">
                                <Icons.ArrowRight className="w-6 h-6 text-slate-600 rotate-90" />
                            </div>

                            {/* Output */}
                            <div className="flex flex-col gap-3 group h-full">
                                <div className="flex justify-between items-center px-1">
                                    <label className="text-sm font-semibold text-slate-400 flex items-center gap-2">
                                        <Icons.Sparkles className="w-4 h-4 text-amber-400" /> TOON Salida
                                    </label>
                                    <button onClick={handleCopy} disabled={!toonOutput} className={`text-xs px-4 py-1.5 rounded-md font-medium transition-all flex items-center gap-2 ${copied ? 'bg-emerald-500 text-white' : 'bg-indigo-600 hover:bg-indigo-500 text-white'}`}>
                                        {copied ? <Icons.Check className="w-3 h-3" /> : <Icons.Copy className="w-3 h-3" />} {copied ? 'Copiado!' : 'Copiar'}
                                    </button>
                                </div>
                                <div className="flex-1 relative rounded-xl border border-indigo-500/20 bg-gradient-to-b from-slate-900/80 to-slate-950/80 min-h-[300px] overflow-hidden">
                                    <div className="absolute top-0 left-0 right-0 h-1 bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500 opacity-50"></div>
                                    <textarea readOnly value={toonOutput} className="w-full h-full bg-transparent p-5 font-mono text-sm resize-none focus:outline-none text-indigo-100"></textarea>
                                    {!toonOutput && !error && (
                                        <div className="absolute inset-0 flex flex-col items-center justify-center text-slate-600 pointer-events-none">
                                            <Icons.Sparkles className="w-12 h-12 mb-2 opacity-20" />
                                            <p className="text-sm">Esperando datos...</p>
                                        </div>
                                    )}
                                </div>
                            </div>
                        </div>

                        {/* Benchmark Section */}
                        <section className="bg-slate-900/50 border border-slate-800 rounded-2xl p-6 md:p-8">
                            <div className="flex items-center gap-2 mb-6">
                                <Icons.TrendingUp className="w-5 h-5 text-emerald-400" />
                                <h2 className="text-lg font-semibold text-slate-200">Compatibilidad con IA (2025)</h2>
                                <div className="ml-auto flex items-center gap-2">
                                    <span className="text-xs text-slate-500 bg-slate-950 px-3 py-1 rounded-full border border-slate-800 flex items-center gap-1">
                                        <Icons.Activity className="w-3 h-3 text-indigo-400"/> n8n AI Builder
                                    </span>
                                </div>
                            </div>

                            <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
                                <div className="space-y-4">
                                    {models.map((model) => (
                                        <div key={model.id} className="group">
                                            <div className="flex justify-between items-end mb-1">
                                                <span className="text-sm font-medium text-slate-300 flex items-center gap-2">
                                                    {model.name} <span className="text-xs text-slate-600 px-1.5 py-0.5 bg-slate-800 rounded">{model.provider}</span>
                                                </span>
                                                <span className="text-sm font-bold text-slate-200">{model.score}/100</span>
                                            </div>
                                            <div className="w-full bg-slate-800 rounded-full h-2.5 overflow-hidden">
                                                <div className={`h-full rounded-full ${model.color}`} style={{ width: `${model.score}%` }}></div>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                                <div className="bg-slate-950/50 rounded-xl p-6 border border-slate-800/50 flex flex-col justify-center">
                                    <h3 className="text-sm font-semibold text-slate-300 mb-4 flex items-center gap-2">
                                        <Icons.Server className="w-4 h-4 text-indigo-400" /> n8n AI Workflow Builder
                                    </h3>
                                    <ul className="space-y-3 text-sm text-slate-400 list-disc list-inside">
                                        <li><strong>Integración Enterprise:</strong> Compatible con el último AI Builder.</li>
                                        <li><strong>Claude 4.5 & Gemini 3:</strong> Compresión ideal para razonamiento.</li>
                                        <li><strong>Grok 4.1:</strong> Optimizado para baja latencia.</li>
                                    </ul>
                                </div>
                            </div>
                        </section>
                    </main>
                    <footer className="max-w-7xl mx-auto mt-8 text-center text-slate-600 text-xs pb-8">
                        <p>TOON v2.1 - Optimizado para n8n Enterprise Cloud & AI Agents.</p>
                    </footer>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
